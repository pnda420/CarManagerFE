<div class="form-container">
    <!-- Header -->
    <header class="form-header">
        <button class="btn-back" (click)="router.navigate(['/services/one-pager'])">
            <span class="material-symbols-outlined">arrow_back</span>
        </button>
        <div class="header-text">
            <h1>Neue Website erstellen</h1>
            <p>In 4 einfachen Schritten zu deiner Vorschau</p>
        </div>
        <div class="progress-wrapper">
            <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="getProgressPercentage()"></div>
            </div>
            <span class="progress-text">{{ getProgressPercentage() }}%</span>
        </div>
    </header>

    <form [formGroup]="form" (ngSubmit)="onSubmit()" novalidate>

        <!-- Step 01: Projekt -->
        <section class="step-card animate-in" style="animation-delay: 0.1s">
            <div class="step-header">
                <div class="step-number">
                    <span>01</span>
                    <div class="step-pulse"></div>
                </div>
                <div class="step-title">
                    <h2>Projekt</h2>
                    <p>Grundlegende Infos</p>
                </div>
            </div>

            <div class="step-content">
                <!-- Customer Type -->
                <div class="field-group">
                    <label class="field-label">
                        Ich bin...
                        <span class="required">*</span>
                    </label>
                    <div class="choice-pills">
                        <button type="button" *ngFor="let type of customerTypes" class="pill-btn"
                            [class.active]="form.get('customerType')?.value === type.value"
                            (click)="form.patchValue({customerType: type.value})">
                            <span class="pill-icon">{{ type.icon }}</span>
                            <span class="pill-text">{{ type.label }}</span>
                            <span class="pill-check material-symbols-outlined">check_circle</span>
                        </button>
                    </div>
                    <span class="error-msg" *ngIf="isFieldInvalid('customerType')">
                        <span class="material-symbols-outlined">error</span>
                        Bitte wähle eine Option
                    </span>
                </div>

                <!-- Company Name (conditional) -->
                <div class="field-group" *ngIf="form.get('customerType')?.value === 'business'">
                    <label for="companyName" class="field-label">
                        Firmenname
                        <span class="required">*</span>
                    </label>
                    <div class="input-field" [class.error]="isFieldInvalid('companyName')">
                        <span class="field-icon material-symbols-outlined">business</span>
                        <input id="companyName" type="text" formControlName="companyName"
                            placeholder="z.B. Mustermann GmbH" />
                    </div>
                    <span class="error-msg" *ngIf="isFieldInvalid('companyName')">
                        <span class="material-symbols-outlined">error</span>
                        Firmenname erforderlich
                    </span>
                </div>

                <!-- Project Name -->
                <div class="field-group">
                    <label for="projectName" class="field-label">
                        Projektname
                        <span class="required">*</span>
                    </label>
                    <div class="input-field" [class.error]="isFieldInvalid('projectName')">
                        <span class="field-icon material-symbols-outlined">label</span>
                        <input id="projectName" type="text" formControlName="projectName"
                            placeholder="z.B. Mein Café, Portfolio" />
                    </div>
                    <span class="error-msg" *ngIf="isFieldInvalid('projectName')">
                        <span class="material-symbols-outlined">error</span>
                        Projektname erforderlich
                    </span>
                </div>

                <!-- Website Type -->
                <div class="field-group">
                    <label class="field-label">
                        Art der Website
                        <span class="required">*</span>
                    </label>
                    <div class="type-grid">
                        <label class="type-card" *ngFor="let type of websiteTypes">
                            <input type="radio" name="typeOfWebsite" [value]="type.value"
                                formControlName="typeOfWebsite" />
                            <div class="type-content">
                                <span class="type-icon">{{ type.icon }}</span>
                                <span class="type-name">{{ type.label }}</span>
                                <span class="type-desc">{{ type.description }}</span>
                                <span class="type-check material-symbols-outlined">check_circle</span>
                            </div>
                        </label>
                    </div>
                    <span class="error-msg" *ngIf="isFieldInvalid('typeOfWebsite')">
                        <span class="material-symbols-outlined">error</span>
                        Bitte wähle eine Website-Art
                    </span>
                </div>
            </div>
        </section>

        <!-- Step 02: Design -->
        <section class="step-card animate-in" style="animation-delay: 0.2s">
            <div class="step-header">
                <div class="step-number">
                    <span>02</span>
                    <div class="step-pulse"></div>
                </div>
                <div class="step-title">
                    <h2>Design</h2>
                    <p>Farben & Stil</p>
                </div>
            </div>

            <div class="step-content">
                <!-- Primary Color -->
                <div class="field-group">
                    <label for="primaryColor" class="field-label">Hauptfarbe</label>
                    <div class="color-field">
                        <input id="primaryColor" type="color" formControlName="primaryColor" class="color-input" />
                        <div class="color-details">
                            <span class="color-name">Deine Markenfarbe</span>
                            <span class="color-hex">{{ form.get('primaryColor')?.value }}</span>
                        </div>
                    </div>
                </div>

                <!-- Design Style -->
                <div class="field-group">
                    <label for="designStyle" class="field-label">Design-Stil</label>
                    <div class="input-field">
                        <span class="field-icon material-symbols-outlined">palette</span>
                        <select id="designStyle" formControlName="designStyle">
                            <option value="modern">Modern & minimal</option>
                            <option value="friendly">Freundlich & klar</option>
                            <option value="elegant">Elegant</option>
                            <option value="playful">Verspielt</option>
                        </select>
                    </div>
                </div>
            </div>
        </section>

        <!-- Step 03: Inhalt -->
        <section class="step-card animate-in" style="animation-delay: 0.3s">
            <div class="step-header">
                <div class="step-number">
                    <span>03</span>
                    <div class="step-pulse"></div>
                </div>
                <div class="step-title">
                    <h2>Inhalt</h2>
                    <p>Beschreibe dein Projekt</p>
                </div>
            </div>

            <div class="step-content">
                <div class="field-group">
                    <label for="contentInformation" class="field-label">
                        <span>Was machst du?</span>
                        <span class="char-count">{{ getCharCount() }}/500</span>
                    </label>
                    <textarea id="contentInformation" rows="6" formControlName="contentInformation"
                        placeholder="Beispiel: Ein gemütliches Café im Herzen der Stadt. Wir servieren frischen Kaffee und hausgemachte Kuchen."
                        [class.error]="isFieldInvalid('contentInformation')" maxlength="500"></textarea>
                    <span class="field-hint">Mindestens 30 Zeichen für eine gute Vorschau</span>
                    <span class="error-msg" *ngIf="isFieldInvalid('contentInformation')">
                        <span class="material-symbols-outlined">error</span>
                        Mindestens 30 Zeichen erforderlich
                    </span>
                </div>
            </div>
        </section>

        <!-- Step 04: E-Mail -->
        <section class="step-card animate-in" style="animation-delay: 0.4s">
            <div class="step-header">
                <div class="step-number">
                    <span>04</span>
                    <div class="step-pulse"></div>
                </div>
                <div class="step-title">
                    <h2>E-Mail</h2>
                    <p>Vorschau erhalten</p>
                </div>
            </div>

            <div class="step-content">
                <div class="field-group">
                    <label for="email" class="field-label">
                        Deine E-Mail-Adresse
                        <span class="required">*</span>
                    </label>
                    <div class="input-field" [class.error]="isFieldInvalid('email')">
                        <span class="field-icon material-symbols-outlined">mail</span>
                        <input id="email" type="email" formControlName="email" placeholder="dein.name@example.com" />
                    </div>
                    <span class="field-hint">
                        <span class="material-symbols-outlined">info</span>
                        Wir schicken dir den Link zur generierten Vorschau
                    </span>
                    <span class="error-msg" *ngIf="isFieldInvalid('email')">
                        <span class="material-symbols-outlined">error</span>
                        Bitte gib eine gültige E-Mail an
                    </span>
                </div>
            </div>
        </section>

        <!-- Quality Selector -->
        <div class="quality-selector" *ngIf="form.valid">
            <div class="quality-header">
                <span class="material-symbols-outlined">tune</span>
                <h3>Qualität wählen</h3>
            </div>
            <div class="quality-options">
                <button type="button" class="quality-option" [class.active]="selectedQuality === 'fast'"
                    (click)="selectQuality('fast')">
                    <span class="quality-emoji">⚡</span>
                    <span class="quality-name">Schnell</span>
                    <span class="quality-time">~1-2 Min</span>
                    <span class="quality-check material-symbols-outlined">check_circle</span>
                </button>
                <button type="button" class="quality-option" [class.active]="selectedQuality === 'balanced'"
                    (click)="selectQuality('balanced')">
                    <span class="quality-emoji">⭐</span>
                    <span class="quality-name">Standard</span>
                    <span class="quality-time">~2-3 Min</span>
                    <span class="quality-check material-symbols-outlined">check_circle</span>
                </button>
                <button type="button" class="quality-option" [class.active]="selectedQuality === 'premium'"
                    (click)="selectQuality('premium')">
                    <span class="quality-emoji">💎</span>
                    <span class="quality-name">Premium</span>
                    <span class="quality-time">~3-5 Min</span>
                    <span class="quality-check material-symbols-outlined">check_circle</span>
                </button>
            </div>
        </div>

        <!-- Actions -->
        <div class="form-actions">
            <button type="button" class="btn btn--secondary" (click)="onReset()">
                <span class="material-symbols-outlined ms-size-20">refresh</span>
                <span>Zurücksetzen</span>
            </button>
            <button type="submit" class="btn btn--primary btn--large" [disabled]="loading || form.invalid"
                [class.loading]="loading">
                <span *ngIf="!loading" class="btn-content">
                    <span class="material-symbols-outlined ms-size-20">auto_awesome</span>
                    <span>Website generieren</span>
                </span>
                <span *ngIf="loading" class="btn-loading">
                    <span class="spinner"></span>
                    <span>Wird erstellt...</span>
                </span>
            </button>
        </div>

    </form>
</div>