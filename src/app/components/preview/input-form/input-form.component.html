<div class="container form-wrap">

    <!-- AUTH REQUIRED - Reusable Component -->
    <app-auth-required *ngIf="!isLoggedIn" [title]="'Anmeldung erforderlich'"
        [message]="'Um eine Website zu erstellen, musst du angemeldet sein.'" [returnUrl]="currentUrl"
        [showBackButton]="true">
    </app-auth-required>

    <!-- FORM -->
    <div *ngIf="isLoggedIn">

        <!-- Header -->
        <header class="form-header">
            <button class="btn btn--ghost btn--icon" (click)="router.navigate(['/services/one-pager'])">
                <span class="material-symbols-outlined">arrow_back</span>
            </button>
            <div class="header-content">
                <h1>Neue Website erstellen</h1>
                <p>Beschreibe dein Projekt in wenigen Schritten.</p>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="getProgressPercentage()"></div>
            </div>
        </header>

        <form class="website-form" [formGroup]="form" (ngSubmit)="onSubmit()" novalidate>

            <!-- 01: Projekt -->
            <section class="form-card">
                <div class="card-header">
                    <span class="card-number">01</span>
                    <h2>Projekt</h2>
                </div>

                <div class="form-field">
                    <label>Ich bin... <span class="required">*</span></label>
                    <div class="button-group">
                        <button type="button" *ngFor="let type of customerTypes" class="btn-choice"
                            [class.active]="form.get('customerType')?.value === type.value"
                            (click)="form.patchValue({customerType: type.value})">
                            <span class="choice-icon">{{ type.icon }}</span>
                            <span>{{ type.label }}</span>
                        </button>
                    </div>
                    <span class="error-text" *ngIf="isFieldInvalid('customerType')">
                        <span class="material-symbols-outlined">error</span>
                        Bitte w√§hlen
                    </span>
                </div>

                <div class="form-field" *ngIf="form.get('customerType')?.value === 'business'">
                    <label for="companyName">Firmenname <span class="required">*</span></label>
                    <div class="input-wrapper">
                        <span class="input-icon material-symbols-outlined">business</span>
                        <input id="companyName" type="text" formControlName="companyName"
                            placeholder="z.B. Mustermann GmbH" [class.error]="isFieldInvalid('companyName')" />
                    </div>
                    <span class="error-text" *ngIf="isFieldInvalid('companyName')">
                        <span class="material-symbols-outlined">error</span>
                        Firmenname erforderlich
                    </span>
                </div>

                <div class="form-field">
                    <label for="projectName">Projektname <span class="required">*</span></label>
                    <div class="input-wrapper">
                        <span class="input-icon material-symbols-outlined">label</span>
                        <input id="projectName" type="text" formControlName="projectName"
                            placeholder="z.B. Mein Caf√©, Portfolio" [class.error]="isFieldInvalid('projectName')" />
                    </div>
                    <span class="error-text" *ngIf="isFieldInvalid('projectName')">
                        <span class="material-symbols-outlined">error</span>
                        Projektname erforderlich
                    </span>
                </div>

                <div class="form-field">
                    <label>Art der Website <span class="required">*</span></label>
                    <div class="card-grid">
                        <label class="choice-card" *ngFor="let type of websiteTypes">
                            <input type="radio" name="typeOfWebsite" [value]="type.value"
                                formControlName="typeOfWebsite" />
                            <div class="choice-card-content">
                                <span class="choice-card-icon">{{ type.icon }}</span>
                                <span class="choice-card-title">{{ type.label }}</span>
                                <span class="choice-card-desc">{{ type.description }}</span>
                            </div>
                        </label>
                    </div>
                    <span class="error-text" *ngIf="isFieldInvalid('typeOfWebsite')">
                        <span class="material-symbols-outlined">error</span>
                        Bitte w√§hlen
                    </span>
                </div>
            </section>

            <!-- 02: Design -->
            <section class="form-card">
                <div class="card-header">
                    <span class="card-number">02</span>
                    <h2>Design</h2>
                </div>

                <div class="form-field">
                    <label for="primaryColor">Hauptfarbe</label>
                    <div class="color-picker">
                        <input id="primaryColor" type="color" formControlName="primaryColor" />
                        <div class="color-info">
                            <span class="color-label">Deine Markenfarbe</span>
                            <span class="color-value">{{ form.get('primaryColor')?.value }}</span>
                        </div>
                    </div>
                </div>

                <div class="form-field">
                    <label for="designStyle">Stil</label>
                    <div class="input-wrapper">
                        <span class="input-icon material-symbols-outlined">palette</span>
                        <select id="designStyle" formControlName="designStyle">
                            <option value="modern">Modern & minimal</option>
                            <option value="friendly">Freundlich & klar</option>
                            <option value="elegant">Elegant</option>
                            <option value="playful">Verspielt</option>
                        </select>
                    </div>
                </div>
            </section>

            <!-- 03: Inhalt -->
            <section class="form-card">
                <div class="card-header">
                    <span class="card-number">03</span>
                    <h2>Inhalt</h2>
                </div>

                <div class="form-field">
                    <label for="contentInformation">
                        Beschreibe dein Projekt <span class="required">*</span>
                        <span class="char-counter">{{ getCharCount() }}/500</span>
                    </label>
                    <textarea id="contentInformation" rows="8" formControlName="contentInformation"
                        placeholder="Beispiel: Ein gem√ºtliches Caf√© im Herzen der Stadt. Wir servieren frischen Kaffee und hausgemachte Kuchen."
                        [class.error]="isFieldInvalid('contentInformation')" maxlength="500"></textarea>
                    <p class="field-hint">Min. 30 Zeichen</p>
                    <span class="error-text" *ngIf="isFieldInvalid('contentInformation')">
                        <span class="material-symbols-outlined">error</span>
                        Mindestens 30 Zeichen
                    </span>
                </div>
            </section>

            <!-- Quality Selector -->
            <div class="quality-card" *ngIf="form.valid">
                <div class="card-header">
                    <span class="material-symbols-outlined">settings</span>
                    <h3>Generierungs-Qualit√§t</h3>
                </div>
                <div class="quality-options">
                    <button type="button" class="quality-btn" [class.active]="selectedQuality === 'fast'"
                        (click)="selectQuality('fast')">
                        <span class="quality-emoji">‚ö°</span>
                        <div class="quality-info">
                            <span class="quality-name">Schnell</span>
                            <span class="quality-time">~1-2 Min</span>
                        </div>
                    </button>
                    <button type="button" class="quality-btn" [class.active]="selectedQuality === 'balanced'"
                        (click)="selectQuality('balanced')">
                        <span class="quality-emoji">‚≠ê</span>
                        <div class="quality-info">
                            <span class="quality-name">Standard</span>
                            <span class="quality-time">~2-3 Min</span>
                        </div>
                    </button>
                    <button type="button" class="quality-btn" [class.active]="selectedQuality === 'premium'"
                        (click)="selectQuality('premium')">
                        <span class="quality-emoji">üíé</span>
                        <div class="quality-info">
                            <span class="quality-name">Premium</span>
                            <span class="quality-time">~3-5 Min</span>
                        </div>
                    </button>
                </div>
            </div>

            <!-- Actions -->
            <div class="form-actions">
                <button type="button" class="btn btn--secondary" (click)="onReset()">
                    <span class="material-symbols-outlined ms-size-20">refresh</span>
                    Zur√ºcksetzen
                </button>
                <button type="submit" class="btn btn--primary" [disabled]="loading || form.invalid"
                    [class.loading]="loading">
                    <span *ngIf="!loading">
                        <span class="material-symbols-outlined ms-size-20">auto_awesome</span>
                        Website generieren
                    </span>
                    <span *ngIf="loading" class="loading-content">
                        <span class="spinner"></span>
                        Wird erstellt...
                    </span>
                </button>
            </div>

        </form>
    </div>
</div>