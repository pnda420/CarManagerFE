<app-admin-header></app-admin-header>

<section class="admin-newsletter">
    <div class="container">

        <!-- Header -->
        <div class="newsletter__header">
            <div class="header__info">
                <h2>Newsletter-Abonnenten</h2>
                <p class="subtitle">Verwalte deine E-Mail-Liste</p>
            </div>
            <div class="header__badges">
                <div class="badge badge--primary" aria-label="Aktive Abonnenten">
                    <span class="count">{{ getActiveCount() }}</span>
                    <span class="label">Aktiv</span>
                </div>
                <div class="badge badge--secondary" aria-label="Gesamt Abonnenten">
                    <span class="count">{{ subscribers.length || 0 }}</span>
                    <span class="label">Gesamt</span>
                </div>
            </div>
        </div>

        <!-- Action Bar (scrollbar auf Mobile) -->
        <div class="action-bar" role="toolbar">
            <button class="btn btn--primary" (click)="copyAllEmails()" title="Alle E-Mails kopieren">
                <span class="btn__icon" aria-hidden="true">📋</span>
                <span class="btn__label">Alle E-Mails</span>
            </button>

            <button class="btn btn--secondary" (click)="exportToCSV()" title="Liste als CSV exportieren">
                <span class="btn__icon" aria-hidden="true">📥</span>
                <span class="btn__label">CSV exportieren</span>
            </button>

            <button class="btn btn--ghost" (click)="loadSubscribers()" title="Aktualisieren">
                <span class="btn__icon" aria-hidden="true">🔄</span>
                <span class="btn__label">Aktualisieren</span>
            </button>
        </div>

        <!-- States -->
        <div *ngIf="loading" class="loading-state">
            <div class="spinner"></div>
            <p>Lade Abonnenten…</p>
        </div>

        <div *ngIf="error && !loading" class="error-state">
            <p>❌ {{ error }}</p>
            <button class="btn btn--secondary" (click)="loadSubscribers()">Erneut versuchen</button>
        </div>

        <div *ngIf="!loading && !error && subscribers.length === 0" class="empty-state">
            <div class="empty__icon">📭</div>
            <h3>Noch keine Abonnenten</h3>
            <p>Newsletter-Anmeldungen erscheinen hier.</p>
        </div>

        <!-- Liste -->
        <div *ngIf="!loading && !error && subscribers.length > 0" class="subscribers__list">
            <article *ngFor="let s of subscribers; trackBy: trackByEmail" class="subscriber-card">

                <header class="card__header">
                    <div class="header__left">
                        <div class="email-row" [title]="s.email">
                            <span class="email">{{ s.email }}</span>
                            <span *ngIf="copiedEmail === s.email" class="copied-badge">✓ Kopiert</span>
                        </div>
                        <div class="meta-row">
                            <span class="time">{{ formatDate(s.subscribedAt) }}</span>
                            <span class="dot">•</span>
                            <span class="status-text" [class.ok]="s.isActive" [class.muted]="!s.isActive">
                                {{ s.isActive ? 'Aktiv' : 'Inaktiv' }}
                            </span>
                        </div>
                    </div>

                    <span class="status-badge" [class.status--active]="s.isActive"
                        [class.status--inactive]="!s.isActive">
                        {{ s.isActive ? '✓ Aktiv' : '✗ Inaktiv' }}
                    </span>
                </header>

                <div class="card__actions">
                    <button class="btn btn--primary" (click)="copyEmail(s.email)" title="E-Mail kopieren">
                        <span class="btn__icon" aria-hidden="true">📋</span>
                        <span class="btn__label">Kopieren</span>
                    </button>
                    <a class="btn btn--secondary" [href]="'mailto:'+s.email" title="E-Mail schreiben">
                        <span class="btn__icon" aria-hidden="true">✉️</span>
                        <span class="btn__label">Mail</span>
                    </a>
                </div>

            </article>
        </div>

    </div>
</section>