<!-- src/app/features/cars/create-car/create-car.component.html -->
<app-page-title title="Neues Auto"></app-page-title>

<section class="create-car-page">
  <div class="container">
    
    <div class="page-header">
      <h2>Auto hinzufügen</h2>
      <p>Füge ein neues Fahrzeug zu deiner Garage hinzu</p>
    </div>

    <form [formGroup]="carForm" (ngSubmit)="onSubmit()" class="car-form">
      
      <!-- Basic Info -->
      <div class="form-section">
        <h3 class="section-title">Grundinformationen</h3>

        <div class="form-group">
          <label for="name">Name des Autos *</label>
          <input 
            type="text" 
            id="name"
            class="input" 
            formControlName="name"
            placeholder="z.B. Mein Golf GTI"
            [class.input--error]="isFieldInvalid('name')">
          <span class="input-error" *ngIf="isFieldInvalid('name')">
            {{ getFieldError('name') }}
          </span>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="make">Marke *</label>
            <input 
              type="text" 
              id="make"
              class="input" 
              formControlName="make"
              placeholder="z.B. Volkswagen"
              [class.input--error]="isFieldInvalid('make')">
            <span class="input-error" *ngIf="isFieldInvalid('make')">
              {{ getFieldError('make') }}
            </span>
          </div>
          <div class="form-group">
            <label for="model">Modell *</label>
            <input 
              type="text" 
              id="model"
              class="input" 
              formControlName="model"
              placeholder="z.B. Golf VII GTI"
              [class.input--error]="isFieldInvalid('model')">
            <span class="input-error" *ngIf="isFieldInvalid('model')">
              {{ getFieldError('model') }}
            </span>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="modelYear">Baujahr</label>
            <input 
              type="number" 
              id="modelYear"
              class="input" 
              formControlName="modelYear"
              placeholder="z.B. 2015"
              [class.input--error]="isFieldInvalid('modelYear')">
            <span class="input-hint" *ngIf="f['modelYear'].value && (f['modelYear'].value < 1900 || f['modelYear'].value > 2030)">
              Bitte ein Jahr zwischen 1900 und 2030 eingeben
            </span>
          </div>
          <div class="form-group">
            <label for="licensePlate">Kennzeichen</label>
            <input 
              type="text" 
              id="licensePlate"
              class="input" 
              formControlName="licensePlate"
              placeholder="z.B. XX-AB 1234">
          </div>
        </div>

        <div class="form-group">
          <label for="vin">FIN / VIN (Fahrzeugidentifikationsnummer)</label>
          <input 
            type="text" 
            id="vin"
            class="input" 
            formControlName="vin"
            placeholder="z.B. WVWZZZ1JZYW123456">
        </div>
      </div>

      <!-- Performance -->
      <div class="form-section">
        <h3 class="section-title">Leistung & Antrieb</h3>

        <div class="form-row">
          <div class="form-group">
            <label for="horsepowerPs">Leistung (PS) *</label>
            <input 
              type="number" 
              id="horsepowerPs"
              class="input" 
              formControlName="horsepowerPs"
              placeholder="z.B. 230"
              [class.input--error]="isFieldInvalid('horsepowerPs')">
            <span class="input-error" *ngIf="isFieldInvalid('horsepowerPs')">
              {{ getFieldError('horsepowerPs') }}
            </span>
          </div>
          <div class="form-group">
            <label for="torqueNm">Drehmoment (Nm)</label>
            <input 
              type="number" 
              id="torqueNm"
              class="input" 
              formControlName="torqueNm"
              placeholder="z.B. 350">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="displacementCc">Hubraum (ccm)</label>
            <input 
              type="number" 
              id="displacementCc"
              class="input" 
              formControlName="displacementCc"
              placeholder="z.B. 1984">
          </div>
          <div class="form-group">
            <label for="fuel">Kraftstoff *</label>
            <select 
              id="fuel"
              class="input" 
              formControlName="fuel"
              [class.input--error]="isFieldInvalid('fuel')">
              <option [value]="FuelType.PETROL">Benzin</option>
              <option [value]="FuelType.DIESEL">Diesel</option>
              <option [value]="FuelType.HYBRID">Hybrid</option>
              <option [value]="FuelType.ELECTRIC">Elektrisch</option>
              <option [value]="FuelType.LPG">LPG</option>
              <option [value]="FuelType.CNG">CNG</option>
              <option [value]="FuelType.OTHER">Andere</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="induction">Aufladung</label>
            <select id="induction" class="input" formControlName="induction">
              <option [ngValue]="null">Keine Angabe</option>
              <option [value]="Induction.NONE">Saugmotor</option>
              <option [value]="Induction.TURBO">Turbolader</option>
              <option [value]="Induction.SUPERCHARGER">Kompressor</option>
              <option [value]="Induction.ELECTRIC">Elektrisch</option>
              <option [value]="Induction.OTHER">Andere</option>
            </select>
          </div>
          <div class="form-group">
            <label for="gears">Anzahl Gänge</label>
            <input 
              type="number" 
              id="gears"
              class="input" 
              formControlName="gears"
              placeholder="z.B. 6">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="transmission">Getriebe</label>
            <select id="transmission" class="input" formControlName="transmission">
              <option [ngValue]="null">Keine Angabe</option>
              <option [value]="Transmission.MANUAL">Manuell</option>
              <option [value]="Transmission.AUTOMATIC">Automatik</option>
              <option [value]="Transmission.DSG">DSG</option>
              <option [value]="Transmission.CVT">CVT</option>
              <option [value]="Transmission.OTHER">Andere</option>
            </select>
          </div>
          <div class="form-group">
            <label for="drivetrain">Antrieb</label>
            <select id="drivetrain" class="input" formControlName="drivetrain">
              <option [ngValue]="null">Keine Angabe</option>
              <option [value]="Drivetrain.FWD">Frontantrieb</option>
              <option [value]="Drivetrain.RWD">Heckantrieb</option>
              <option [value]="Drivetrain.AWD">Allrad</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Body & Weight -->
      <div class="form-section">
        <h3 class="section-title">Karosserie & Gewicht</h3>

        <div class="form-row">
          <div class="form-group">
            <label for="kerbWeightKg">Leergewicht (kg)</label>
            <input 
              type="number" 
              id="kerbWeightKg"
              class="input" 
              formControlName="kerbWeightKg"
              placeholder="z.B. 1450">
          </div>
          <div class="form-group">
            <label for="bodyType">Karosserieform</label>
            <select id="bodyType" class="input" formControlName="bodyType">
              <option [ngValue]="null">Keine Angabe</option>
              <option [value]="BodyType.SEDAN">Limousine</option>
              <option [value]="BodyType.WAGON">Kombi</option>
              <option [value]="BodyType.COUPE">Coupé</option>
              <option [value]="BodyType.CONVERTIBLE">Cabrio</option>
              <option [value]="BodyType.SUV">SUV</option>
              <option [value]="BodyType.VAN">Van</option>
              <option [value]="BodyType.PICKUP">Pickup</option>
              <option [value]="BodyType.HATCHBACK">Schrägheck</option>
              <option [value]="BodyType.OTHER">Andere</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="doors">Anzahl Türen</label>
            <input 
              type="number" 
              id="doors"
              class="input" 
              formControlName="doors"
              placeholder="z.B. 5">
          </div>
          <div class="form-group">
            <label for="seats">Anzahl Sitze</label>
            <input 
              type="number" 
              id="seats"
              class="input" 
              formControlName="seats"
              placeholder="z.B. 5">
          </div>
        </div>
      </div>

      <!-- Mileage & Maintenance -->
      <div class="form-section">
        <h3 class="section-title">Kilometerstand & Wartung</h3>

        <div class="form-group">
          <label for="mileageKm">Kilometerstand (km) *</label>
          <input 
            type="number" 
            id="mileageKm"
            class="input" 
            formControlName="mileageKm"
            placeholder="z.B. 85000"
            [class.input--error]="isFieldInvalid('mileageKm')">
          <span class="input-error" *ngIf="isFieldInvalid('mileageKm')">
            {{ getFieldError('mileageKm') }}
          </span>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="nextTuvDate">Nächster TÜV</label>
            <input 
              type="date" 
              id="nextTuvDate"
              class="input" 
              formControlName="nextTuvDate">
          </div>
          <div class="form-group">
            <label for="nextServiceDate">Nächster Service (Datum)</label>
            <input 
              type="date" 
              id="nextServiceDate"
              class="input" 
              formControlName="nextServiceDate">
          </div>
        </div>

        <div class="form-group">
          <label for="nextServiceKm">Nächster Service (km)</label>
          <input 
            type="number" 
            id="nextServiceKm"
            class="input" 
            formControlName="nextServiceKm"
            placeholder="z.B. 90000">
        </div>
      </div>

      <!-- Performance Stats -->
      <div class="form-section">
        <h3 class="section-title">Leistungsdaten (Optional)</h3>

        <div class="form-row">
          <div class="form-group">
            <label for="zeroToHundredS">0-100 km/h (Sekunden)</label>
            <input 
              type="number" 
              step="0.1" 
              id="zeroToHundredS"
              class="input" 
              formControlName="zeroToHundredS"
              placeholder="z.B. 6.5">
          </div>
          <div class="form-group">
            <label for="topSpeedKmh">Höchstgeschwindigkeit (km/h)</label>
            <input 
              type="number" 
              id="topSpeedKmh"
              class="input" 
              formControlName="topSpeedKmh"
              placeholder="z.B. 250">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="powerToWeightPsPerKg">Leistungsgewicht (PS/kg)</label>
            <input 
              type="number" 
              step="0.01" 
              id="powerToWeightPsPerKg"
              class="input" 
              formControlName="powerToWeightPsPerKg"
              placeholder="z.B. 6.32">
          </div>
          <div class="form-group">
            <label for="consumptionLPer100km">Verbrauch (l/100km)</label>
            <input 
              type="number" 
              step="0.1" 
              id="consumptionLPer100km"
              class="input" 
              formControlName="consumptionLPer100km"
              placeholder="z.B. 7.5">
          </div>
        </div>
      </div>

      <!-- Images -->
      <div class="form-section">
        <h3 class="section-title">Bilder</h3>

        <div class="image-upload-zone">
          <input 
            type="file" 
            id="imageUpload" 
            accept="image/*" 
            multiple 
            (change)="onImageSelect($event)"
            style="display: none">

          <label for="imageUpload" class="upload-label">
            <span class="material-symbols-outlined">add_photo_alternate</span>
            <span>Bilder hinzufügen</span>
            <span class="upload-hint">Klicken oder ziehen Sie Bilder hierher</span>
          </label>
        </div>

        <!-- Image Previews -->
        <div class="image-previews" *ngIf="imagePreviewUrls.length > 0">
          <div class="image-preview" *ngFor="let url of imagePreviewUrls; let i = index">
            <img [src]="url" alt="Preview">
            <button type="button" class="remove-image" (click)="removeImage(i)">
              <span class="material-symbols-outlined">close</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button 
          type="button" 
          class="btn btn--ghost btn--large" 
          (click)="onCancel()"
          [disabled]="loading">
          Abbrechen
        </button>
        <button 
          type="submit" 
          class="btn btn--primary btn--large" 
          [disabled]="loading || carForm.invalid">
          <span class="material-symbols-outlined" *ngIf="!loading">save</span>
          <span class="spinner-small" *ngIf="loading"></span>
          {{ loading ? 'Speichere...' : 'Auto erstellen' }}
        </button>
      </div>

    </form>

  </div>
</section>